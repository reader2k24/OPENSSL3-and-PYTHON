# Руководство по асимметричному шифрованию и расшифрованию с помощью RSA в командной строке с использованием OpenSSL

Этот репозиторий содержит инструкции и программы для шифрования и расшифрования данных с использованием RSA в командной строке с помощью OpenSSL.

## Генерация ключевой пары RSA

### Шаги
1. Сгенерируйте 4096-битовую пару ключей и сохраните ее в файл `rsa_keypair.pem`:
    ```bash
    openssl genpkey -algorithm RSA -pkeyopt rsa_keygen_bits:4096 -out rsa_keypair.pem
    ```

## Извлечение открытого ключа из пары

### Шаги
1. Извлеките открытый ключ из сгенерированной пары и сохраните его в файл `rsa_public_key.pem`:
    ```bash
    openssl pkey -in rsa_keypair.pem -pubout -out rsa_public_key.pem
    ```

## Шифрование с помощью RSA в командной строке

### Шаги
1. Сгенерируйте сеансовый ключ, например, 256-битовый:
    ```bash
    openssl rand -out session_key.bin 32
    ```
2. Зашифруйте сеансовый ключ с использованием открытого ключа RSA и сохраните зашифрованный ключ в файл:
    ```bash
    openssl pkeyutl -encrypt -in session_key.bin -out session_key.bin.encrypted -pubin -inkey rsa_public_key.pem -pkeyopt rsa_padding_mode:oaep
    ```
3. Проверьте созданные файлы:
   ```bash
   cksum session_key.bin*
   ```
    Отметим, что длина входного сеансового ключа равна всего 32 байта (256 бит), но в зашифрованном виде он занимает уже 512 байт (4096 бит), поскольку размер блока выходного шифртекста RSA равен длине ключа.Попробуйте зашифровать сеансовый ключ несколько раз и убедитесь, что размер зашифрованного файла всегда один и тот же, но контрольная сумма всякий раз разная. Хотя само RSA-шифрование детерминировано, допол­нение OAEP таковым не является, в результате чего шифртекст получается недетерминированным.Мы успешно зашифровали небольшой файл.

## Расшифрование с помощью RSA в командной строке

### Шаги
1. Расшифруйте зашифрованный сеансовый ключ с использованием пары ключей RSA и сохраните расшифрованный ключ в файл:
    ```bash
    openssl pkeyutl -decrypt -in session_key.bin.encrypted -out session_key.bin.decrypted -inkey rsa_keypair.pem -pkeyopt rsa_padding_mode:oaep
    ```
2. Проверьте расшифрованный файл:
   ```bash
   cksum session_key.bin*
   ```
    Как видим, размеры и контрольные суммы файлов session_key.bin и session_key.bin.decrypted одинаковы, т. е. расшифрованный файл совпадает с исходным. Замечательно, что расшифрование всегда детерминировано!

## Шифрование с помощью программы `rsa-encrypt`
Наша программа будет принимать три аргумента в командной строке:
- имя входного файла
- имя выходного файла
- имя файла с открытым ключом RSA

### Шаги
1. Удалите ранее созданный зашифрованный и расшифрованный файл:
    ```bash
    rm session_key.bin.*
    ```
2. Для шифрования выполните программу `rsa-encrypt`:
    ```bash
    python3 rsa-encrypt session_key.bin session_key.bin.encrypted rsa_public_key.pem
    ```
3. Программа является интероперабельной с openssl pkeyutl. Проверка:
    ```bash
    openssl pkeyutl -decrypt -in session_key.bin.encrypted -out session_key.bin.decrypted -inkey rsa_keypair.pem -pkeyopt rsa_padding_mode:oaep
    ```
4. Ошибок не должно возникнуть. Проверьте зашифрованный файл их контрольные суммы:
   ```bash
   cksum session_key.bin*
   ```

## Расшифрование с помощью программы `rsa-decrypt`
Наша программа будет принимать три аргумента в командной строке:
- имя входного файла
- имя выходного файла
- имя файла с парой ключей

### Шаги
1. Для расшифрования выполните программу `rsa-decrypt`:
    ```bash
    python3 rsa-decrypt session_key.bin.encrypted session_key.bin.decrypted rsa_keypair.pem
    ```
2. Проверьте расашифрованный файл:
   ```bash
   cksum session_key.bin*
   ```
    Размеры и контрольные суммы файлов `session_key.bin` и `session_key.bin.decrypted` должны быть идентичными.

## Заключение

Этот репозиторий предоставляет простые инструкции и программы для шифрования и расшифрования данных с использованием RSA в командной строке с помощью OpenSSL. Вы можете легко шифровать и расшифровывать данные, а также создавать и использовать ключевые пары RSA для обеспечения безопасности ваших данных.
